<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="量化金融 - quantitative finance in javascript">
    <meta name="author" content="Jin Yang">
    <meta name="keywords" content="quantlib.js, 量化金融, notebook, 金融, math, javascript, quant, quantitative, finance, quantitative finance, mathematical finance">
    <meta name="google-site-verification" content="4IrXoRzLpuCL684J3Y19wWtY9W5KqlvwLH5EQuZh1-Q" />
    <meta name="baidu-site-verification" content="5VJ5ngbcQy" />
    <meta name="yandex-verification" content="4e77f9532725d40e" />
    <script data-ad-client="ca-pub-7679847038029953" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <title>quantlib.js © 2020 Jin Yang</title>
    <link rel="shortcut icon" type="image/png" href="/cn.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0-alpha.1075/dist/css/toggle-bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0-alpha.1075/dist/css/toggle-bootstrap-dark.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.16.0/dist/bootstrap-table.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/lib/codemirror.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/theme/base16-light.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/theme/base16-dark.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />        
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-87290595-6"></script>
    <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-87290595-6");</script>
    <script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?fe6b934f326cc497985add8efde0653d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();</script>
    <style>.CodeMirror{height:auto}.cell.row{border-color:#191d21;border-width:.5px;border-style:solid;padding:2px;margin:2px;border-radius:.5em}body{position:relative}.input{padding-top:2px}.output{overflow:auto}#toc{top:56px;left:20px}.navbar-toggler{border-style:none!important}.bootstrap-dark .bg-dark,.bootstrap-dark .navbar-themed{background-color:#191d21!important}.bootstrap .bg-light,.bootstrap .navbar-themed{background-color:#fff!important}nav[data-toggle=toc] .nav>li>a{display:block;padding:4px 20px;font-size:16px;font-weight:500;color:#767676}nav[data-toggle=toc] .nav>li>a:focus,nav[data-toggle=toc] .nav>li>a:hover{padding-left:19px;color:#563d7c;text-decoration:none;background-color:transparent;border-left:1px solid #563d7c}nav[data-toggle=toc] .nav-link.active,nav[data-toggle=toc] .nav-link.active:focus,nav[data-toggle=toc] .nav-link.active:hover{padding-left:18px;font-weight:700;color:#563d7c;background-color:transparent;border-left:2px solid #563d7c}nav[data-toggle=toc] .nav-link+ul{display:none;padding-bottom:10px}nav[data-toggle=toc] .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:14px;font-weight:400}nav[data-toggle=toc] .nav .nav>li>a:focus,nav[data-toggle=toc] .nav .nav>li>a:hover{padding-left:29px}nav[data-toggle=toc] .nav .nav>li>.active,nav[data-toggle=toc] .nav .nav>li>.active:focus,nav[data-toggle=toc] .nav .nav>li>.active:hover{padding-left:28px;font-weight:500}nav[data-toggle=toc] .nav-link.active+ul{display:block}blockquote{border-left:4px solid #ddd;padding:0 15px;color:#777}.json-document{padding:1em 2em}ol.json-array,ul.json-dict{list-style-type:none;margin:0 0 0 1px;padding-left:2em}.json-string{color:#0b7500}.json-literal{color:#1a01cc;font-weight:700}a.json-toggle{position:relative;color:inherit;text-decoration:none}a.json-toggle:focus{outline:0}a.json-toggle:before{font-size:10px;color:silver;content:"\25BC";position:absolute;display:inline-block;width:8px;text-align:center;line-height:8px;left:-10px;top:9px}a.json-toggle:hover:before{color:#aaa}a.json-toggle.collapsed:before{transform:rotate(-90deg)}a.json-placeholder{color:#aaa;padding:0 2px;text-decoration:none}a.json-placeholder:hover{text-decoration:underline}.tsd-signatures{list-style-type:none}.tsd-descriptions{list-style-type:none}aside ul{list-style-type:none}.toast-container{position:sticky;z-index:1055;top:0}.toast-wrapper{position:absolute;z-index:1055;top:0;right:0;margin:5px}.toast-container>.toast-wrapper>.toast{min-width:150px;border-top:none}.toast-container>.toast-wrapper>.toast>.toast-header strong{padding-right:20px}@media (min-width:320px){.taiji{width:320px;height:320px;position:fixed;top:calc(50% - 160px);left:calc(50% - 160px);border-radius:320px;background-color:#000;box-shadow:0 0 40px rgba(0,0,0,.8);animation:rotation 2.5s linear infinite;-webkit-animation:rotation 2.5s linear infinite;-moz-animation:rotation 2.5s linear infinite}.taiji:after,.taiji:before{width:160px;height:320px;position:absolute;top:0;display:block;content:""}.taiji:before{left:0;border-radius:160px 0 0 160px;background-color:#000}.taiji:after{right:0;border-radius:0 160px 160px 0;background-color:#fff}.yang,.yin{width:160px;height:160px;position:absolute;z-index:2;border-radius:240px}.yin{top:0;left:80px;background-color:#000}.yang{bottom:0;right:80px;background-color:#fff}.yang:after,.yin:after{width:60px;height:60px;position:absolute;z-index:3;display:block;content:"";border-radius:60px}.yin:after{top:48px;left:44px;background-color:#fff}.yang:after{z-index:-99;bottom:48px;right:44px;background-color:#000}}@media (min-width:576px){.taiji{width:400px;height:400px;position:fixed;top:calc(50% - 200px);left:calc(50% - 200px);border-radius:400px;background-color:#000;box-shadow:0 0 50px rgba(0,0,0,.8);animation:rotation 2.5s linear infinite;-webkit-animation:rotation 2.5s linear infinite;-moz-animation:rotation 2.5s linear infinite}.taiji:after,.taiji:before{width:200px;height:400px;position:absolute;top:0;display:block;content:""}.taiji:before{left:0;border-radius:200px 0 0 200px;background-color:#000}.taiji:after{right:0;border-radius:0 200px 200px 0;background-color:#fff}.yang,.yin{width:200px;height:200px;position:absolute;z-index:2;border-radius:300px}.yin{top:0;left:100px;background-color:#000}.yang{bottom:0;right:100px;background-color:#fff}.yang:after,.yin:after{width:75px;height:75px;position:absolute;z-index:3;display:block;content:"";border-radius:75px}.yin:after{top:60px;left:55px;background-color:#fff}.yang:after{bottom:60px;right:55px;background-color:#000}}@media (min-width:768px){.taiji{width:480px;height:480px;position:fixed;top:calc(50% - 240px);left:calc(50% - 240px);border-radius:480px;background-color:#000;box-shadow:0 0 50px rgba(0,0,0,.8);animation:rotation 2.5s linear infinite;-webkit-animation:rotation 2.5s linear infinite;-moz-animation:rotation 2.5s linear infinite}.taiji:after,.taiji:before{width:240px;height:480px;position:absolute;top:0;display:block;content:""}.taiji:before{left:0;border-radius:240px 0 0 240px;background-color:#000}.taiji:after{right:0;border-radius:0 240px 240px 0;background-color:#fff}.yang,.yin{width:240px;height:240px;position:absolute;z-index:2;border-radius:360px}.yin{top:0;left:120px;background-color:#000}.yang{bottom:0;right:120px;background-color:#fff}.yang:after,.yin:after{width:90px;height:90px;position:absolute;z-index:3;display:block;content:"";border-radius:90px}.yin:after{top:72px;left:66px;background-color:#fff}.yang:after{bottom:72px;right:66px;background-color:#000}}@keyframes rotation{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@-webkit-keyframes rotation{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@-moz-keyframes rotation{0%{-moz-transform:rotate(0)}100%{-moz-transform:rotate(360deg)}}</style>
  </head>
  <body class="bootstrap-dark" data-spy="scroll" data-target="#toc" data-offset="56">
    <nav class="navbar navbar-themed"><div class=container-fluid><a class=navbar-brand onclick=toggleLock()><i class="fa fa-unlock"id=lock></i></a> <button class=navbar-toggler type=button data-target=#navbarSupportedContent data-toggle=collapse><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse"id=navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"></div></div></nav><div class=container-fluid><div class="row no-gutters"id=root><div class="col-xl-2 hidden-lg-down"id=tocroot><nav class=sticky-top data-toggle=toc id=toc></nav></div><div class="col-lg-12 col-xl-12"id=nbroot><div class=container-fluid id=meta></div><div class=container-fluid id=notebook></div></div></div></div><div class="fade modal show"id=opendialog role=dialog tabindex=-1><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"role=document><div class=modal-content><div class=modal-header><h5 class=modal-title>Manage notebooks</h5><button class=close type=button data-dismiss=modal aria-label=Close><span aria-hidden=true>×</span></button></div><div class=modal-body><div class=output id=nblist><div id=ot-1></div></div></div><div class=modal-footer><button class="btn btn-secondary"type=button data-dismiss=modal>Close</button> <button class="btn btn-primary"type=button onclick=openNotebook()>Open</button> <button class="btn btn-danger"type=button onclick=deleteNotebook()>Delete</button></div></div></div></div><div class="fade modal show"id=savedialog role=dialog tabindex=-1><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"role=document><div class=modal-content><div class=modal-header><h5 class=modal-title>Save notebook</h5><button class=close type=button data-dismiss=modal aria-label=Close><span aria-hidden=true>×</span></button></div><div class=modal-body><form class=needs-validation id=saveform novalidate><div class=row><label class="col-form-label col-sm-2"for=title>Title</label><div class="col-sm-10 form-group"><input autocomplete=off class="form-control form-control-sm"id=title placeholder=""type=search required></div></div><div class=row><label class="col-form-label col-sm-2"for=subtitle>Subtitle</label><div class="col-sm-10 form-group"><input autocomplete=off class="form-control form-control-sm"id=subtitle placeholder=""type=search></div></div><div class=row><label class="col-form-label col-sm-2"for=author>Author</label><div class="col-sm-10 form-group"><input autocomplete=off class="form-control form-control-sm"id=author placeholder=""type=search></div></div></form></div><div class=modal-footer><button class="btn btn-secondary"type=button data-dismiss=modal>Close</button> <button class="btn btn-primary"type=button onclick=saveNotebook()>Save</button> <button class="btn btn-success"type=button onclick=saveAs()>Download</button></div></div></div></div><div class="fade modal show"id=aboutdialog role=dialog tabindex=-1><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"role=document><div class=modal-content><div class=modal-header><h5 class=modal-title>About</h5><button class=close type=button data-dismiss=modal aria-label=Close><span aria-hidden=true>×</span></button></div><div class=modal-body><i class="fa fa-copyright">2020 Jin Yang</i><br><a href=mailto:quantlib.js@outlook.com target=_blank>quantlib.js@outlook.com</a></div><div class=modal-footer><button class="btn btn-secondary"type=button data-dismiss=modal>Close</button></div></div></div></div><div class=taiji><div class=yin></div><div class=yang></div></div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0-alpha.1075/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.16.0/dist/bootstrap-table.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/lib/codemirror.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/mode/javascript/javascript.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/mode/markdown/markdown.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.54.0/mode/sql/sql.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@1.1.0/marked.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@8.1.0/highcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
    <script>window.cookieconsent.initialise({palette:{popup:{background:"#aa0000",text:"#ffdddd"},button:{background:"#ff0000"}},position:"bottom-right"});</script>
    <script>var file,appSize,counter=0,cells={},theme="dark",color_enter="#C1E0FF",light_leave="#ffffff",dark_leave="#191d21",selected=NaN,offset=55,reader=new FileReader,nextcell=!0,scrollcell=!1,locked=!1,dirty=!1,show_toc=!1,history={},tapped=!1,language=window.navigator.userLanguage||window.navigator.language,lang=language.split("-")[0]||"en",nls={en:{default_title:"Welcome",default_subtitle:"",link_tutorial:"Tutorial",link_docs:"API Docs",link_test_suite:"Test Suite",dialog_open_title:"Manage Notebooks",dialog_save_title:"Save Notebook",button_cancel:"Cancel",button_open:"Open",button_delete:"Delete",button_save:"Save"},zh:{default_title:"欢迎",default_subtitle:"",link_tutorial:"教程",link_docs:"文档",link_test_suite:"测试",dialog_open_title:"存储",dialog_save_title:"保存",button_cancel:"取消",button_open:"打开",button_delete:"删除",button_save:"保存"}},touch=!1,mobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),HCDefaults=$.extend(!0,{},Highcharts.getOptions(),{}),dart_chart={colors:["#2b908f","#90ee7e","#f45b5b","#7798BF","#aaeeee","#ff0066","#eeaaee","#55BF3B","#DF5353","#7798BF","#aaeeee"],chart:{backgroundColor:{linearGradient:{x1:0,y1:0,x2:1,y2:1},stops:[[0,"#2a2a2b"],[1,"#3e3e40"]]},style:{fontFamily:"'Unica One', sans-serif"},plotBorderColor:"#606063"},title:{style:{color:"#E0E0E3",fontSize:"20px"}},subtitle:{style:{color:"#E0E0E3"}},xAxis:{gridLineColor:"#707073",labels:{style:{color:"#E0E0E3"}},lineColor:"#707073",minorGridLineColor:"#505053",tickColor:"#707073",title:{style:{color:"#A0A0A3"}}},yAxis:{gridLineColor:"#707073",labels:{style:{color:"#E0E0E3"}},lineColor:"#707073",minorGridLineColor:"#505053",tickColor:"#707073",tickWidth:1,title:{style:{color:"#A0A0A3"}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.85)",style:{color:"#F0F0F0"}},plotOptions:{series:{dataLabels:{color:"#F0F0F3",style:{fontSize:"13px"}},marker:{lineColor:"#333"}},boxplot:{fillColor:"#505053"},candlestick:{lineColor:"white"},errorbar:{color:"white"}},legend:{backgroundColor:"rgba(0, 0, 0, 0.5)",itemStyle:{color:"#E0E0E3"},itemHoverStyle:{color:"#FFF"},itemHiddenStyle:{color:"#606063"},title:{style:{color:"#C0C0C0"}}},credits:{style:{color:"#666"}},labels:{style:{color:"#707073"}},drilldown:{activeAxisLabelStyle:{color:"#F0F0F3"},activeDataLabelStyle:{color:"#F0F0F3"}},navigation:{buttonOptions:{symbolStroke:"#DDDDDD",theme:{fill:"#505053"}}},rangeSelector:{buttonTheme:{fill:"#505053",stroke:"#000000",style:{color:"#CCC"},states:{hover:{fill:"#707073",stroke:"#000000",style:{color:"white"}},select:{fill:"#000003",stroke:"#000000",style:{color:"white"}}}},inputBoxBorderColor:"#505053",inputStyle:{backgroundColor:"#333",color:"silver"},labelStyle:{color:"silver"}},navigator:{handles:{backgroundColor:"#666",borderColor:"#AAA"},outlineColor:"#CCC",maskFill:"rgba(255,255,255,0.1)",series:{color:"#7798BF",lineColor:"#A6C7ED"},xAxis:{gridLineColor:"#505053"}},scrollbar:{barBackgroundColor:"#808083",barBorderColor:"#808083",buttonArrowColor:"#CCC",buttonBackgroundColor:"#606063",buttonBorderColor:"#606063",rifleColor:"#FFF",trackBackgroundColor:"#404043",trackBorderColor:"#404043"}},toolbar=['<button class="btn" type="button" onclick="add(\'javascript\', selected);"><i class="fa fa-plus"></i></button>','<button id="runsel" class="btn" type="button" onclick="run(selected);"><i class="fa fa-play"></i></button>','<button class="btn" type="button" onclick="toggle(selected);"><i id="celltype" class="fa fa-code"></i></button>','<button id="delsel" class="btn" type="button" onclick="del(selected);"><i class="fa fa-trash"></i></button>','<button id="runall" class="btn" type="button" onclick="runAll();"><i class="fa fa-forward"></i></button>','<button id="clearall" class="btn" type="button" onclick="clearAll();"><i class="fa fa-close"></i></button>','<button class="btn" type="button" onclick="color();"><i class="fa fa-adjust"></i></button>','<button class="btn d-none d-xl-block" type="button" onclick="toggleToc();"><i id="layout" class="fa fa-columns"></i></button>','<button class="btn" type="button" onclick="moveUp(selected);"><i class="fa fa-angle-up"></i></buttona>','<button class="btn" type="button" onclick="moveDown(selected);"><i class="fa fa-angle-down"></i></buttona>','<button id="clearsel" class="btn" type="button" onclick="clearCell(selected);"><i class="fa fa-times-circle-o"></i></buttona>','<button id="runup" class="btn" type="button" onclick="runUp();"><i class="fa fa-angle-double-up"></i></button>','<button id="rundown" class="btn" type="button" onclick="runDown();"><i class="fa fa-angle-double-down"></i></button>','<button class="btn" type="button" onclick="compass(NaN);"><i class="fa fa-compass"></i></button>','<button class="btn" type="button" data-toggle="modal" data-target="#opendialog"><i class="fa fa-database"></i></button>','<button class="btn" type="button" data-toggle="modal" data-target="#savedialog"><i class="fa fa-save"></i></button>','<button class="btn" type="button" data-toggle="modal" data-target="#aboutdialog"><i class="fa fa-info-circle"></i></button>'],indicator='<div class="running">\n<div class="spinner-grow text-primary" role="status"></div>\n<div class="spinner-grow text-secondary" role="status"></div>\n<div class="spinner-grow text-success" role="status"></div>\n<div class="spinner-grow text-danger" role="status"></div>\n<div class="spinner-grow text-warning" role="status"></div>\n<div class="spinner-grow text-info" role="status"></div>\n<div class="spinner-grow text-light" role="status"></div>\n<div class="spinner-grow text-dark" role="status"></div>\n</div>',worker=void 0;function startWorker(){var e=new Blob(['var app,notebookDb,notebookTbl,cellTbl,_x_id_x_;onmessage=function(e){switch(e.data.fn){case"code":var t=e.data.id,o=e.data.source;Queue.enqueue(t,e=>new Promise((function(t,a){try{_x_id_x_=e,t(interprete(o))}catch(e){a(e)}})));break;case"sql":t=e.data.id,o="sql(`"+e.data.source.replace(/\\`/g,"\\\\\\`")+"`)";Queue.enqueue(t,e=>new Promise((function(t,a){try{_x_id_x_=e,t(interprete(o))}catch(e){a(e)}})));break;case"firebase":initFirebase(e.data.apiKey,e.data.authDomain,e.data.databaseURL,e.data.projectId,e.data.storageBucket,e.data.messagingSenderId);break;default:throw new Error("invalid fn")}};var Queue=function(){function e(){}return e.enqueue=function(e,t){var o=this;return new Promise((function(a,n){o.queue.push({id:e,promise:t,resolve:a,reject:n}),o.dequeue()}))},e.dequeue=function(){var e=this;if(this.workingOnPromise)return!1;var t=this.queue.shift();return!!t&&(this.workingOnPromise=!0,t.promise(t.id).then(o=>{e.workingOnPromise=!1,postMessage({id:t.id,result:o,fn:"output"}),e.dequeue()}).catch(o=>{e.workingOnPromise=!1,postMessage({id:t.id,result:o.message,fn:"output"}),e.dequeue()}),!0)},e.queue=[],e.pendingPromise=!1,e}();function interprete(e){var t;t=void 0!==self.ts?ts.transpileModule(e,{compilerOptions:{target:"es5"}}).outputText:e;var o=self.eval(t);return void 0!==o&&null!=o.toTex&&"function"==typeof o.toTex&&(o.LaTexString=o.toTex()),o}var list={quantlib:{name:"ql",url:"https://cdn.jsdelivr.net/npm/@quantlib/ql@latest/ql.js"},help:{name:"typedoc",url:"https://cdn.jsdelivr.net/npm/@quantlib/misc@latest/search.js"},math:{name:"math",url:"https://cdn.jsdelivr.net/npm/mathjs@6.6.2/dist/math.min.js"},typescript:{name:"ts",url:"https://cdn.jsdelivr.net/npm/typescript@3.5.3/lib/typescript.js"},sql:{name:"sqlParser",url:"https://cdn.jsdelivr.net/npm/js-sql-parser@1.3.0/dist/parser/sqlParser.min.js"},tensorflow:{name:"tf",url:"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"}};function require(e){if(null==list[e])return{type:"text",data:"Error: unkown library"};if(void 0!==self[list[e].name])return{type:"text",data:e+" loaded already"};try{return importScripts(list[e].url),{type:"text",data:e+" loaded"}}catch(e){return{type:"text",data:e.message}}}function print(e){postMessage({id:_x_id_x_,result:e,fn:"print"})}function table(e){postMessage({id:_x_id_x_,result:e,fn:"table"})}function plot(e){return{type:"plot",data:e}}var kinds={"External module":1,Module:2,Enumeration:4,"Enumeration member":16,Variable:32,Function:64,Class:128,Interface:256,Constructor:512,Property:1024,Method:2048,"Type literal":65536,Accessor:262144,"Object literal":2097152,"Type alias":4194304,Reference:16777216};function help(e,t,o,a="Class"){if(!typedoc)return{type:"text",data:"help library not loaded"};var n,r,l=_x_id_x_,i=typedoc.search.data.rows.filter(t=>t.name==e&&t.kind==kinds[a]);return i&&i.length>0?(n=i[0].url,r=\'<a target="_blank" href="https://quantlib.js.org/docs/\'+n+\'">\'+e+\' <i class="fa fa-external-link"></i></a>\',fetch("https://quantlib.js.org/docs/"+n).then(e=>e.text()).then(e=>{postMessage({id:l,result:{link:r,html:e,section:t,what:o},fn:"help"})}),{type:"help"}):{type:"text",data:e+" not found"}}var error_code={0:"System error",1:"Lovefield library version mismatch.",2:"The database connection is not active.",3:"Operation timeout.",4:"Operation blocked.",5:"Storage quota exceeded.",6:"Too many rows:B-Tree implementation supports at most {0} rows.",7:"Service {0} not registered.",8:"Unknown query plan node.",100:"Data error",101:"Table {0} not found.",102:"Data corruption detected.",103:"Row id must be numbers.",105:"Attempt to access in-flight transaction states.",106:"Attempt to access {0} outside of specified scope.",107:"Invalid transaction state transition:{0} -> {1}.",108:"Attempt to open a newer database with old code.",109:"Attempt to insert a row number that already existed.",110:"Attempt to import into a non-empty database.",111:"Database name/version mismatch for import.",112:"Import data not found.",113:"Attempt to call connect() on an already opened DB connection.",200:"Constraint error",201:"Duplicate keys are not allowed, index:{0}, key:{1}",202:"Attempted to insert NULL value to non-nullable field {0}.",203:"Foreign key constraint violation on constraint {0}.",300:"Not supported",351:"Firebase does not have raw transaction.",352:"IndexedDB is not supported by platform.",353:"WebSQL is not supported by platform.",354:"Unable to open WebSQL database. {0}.",355:"WebSQL does not support change notification.",356:"Use WebSQL instance to create transaction instead.",357:"toSql() does not support predicate type:{0}.",358:"toSql() is not implemented for {0}.",359:"LocalStorage is not supported by platform.",360:"Not implemented yet.",361:"Unable to open IndexedDB database:{0}, {1}.",500:"Syntax error",501:"Value is not bounded.",502:"Naming rule violation:{0}.",503:"Name {0} is already defined.",504:"Can not use autoIncrement with a non-integer primary key.",505:"Can not use autoIncrement with a cross-column primary key.",506:"Lovefield allows only immediate evaluation of cascading constraints.",508:"Table {0} does not have column:{1}.",509:"Attempt to index table {0} on non-indexable column {1}.",510:"Cannot bind to given array:out of range.",511:"IndexedDB tables needs to be acquired from transactions.",512:"WebSQL tables needs to be acquired from transactions.",513:"Unknow query context.",514:"Unknown node type.",515:"from() has already been called.",516:"where() has already been called.",517:"Invalid usage of delete().",518:"Invalid usage of insert().",519:"Attempted to insert or replace in a table with no primary key.",520:"into() has already been called.",521:"values() has already been called.",522:"Invalid usage of select().",523:"Binding parameters of limit/skip without providing values.",524:"Invalid usage of lf.fn.distinct().",525:"Invalid projection list or groupBy columns.",526:"Invalid projection list:mixing aggregated with non-aggregated.",527:"Invalid aggregation detected:{0}",528:"limit() has already been called.",529:"skip() has already been called.",530:"groupBy() has already been called.",531:"Number of rows must not be negative for limit/skip.",532:"Invalid usage of update().",533:"Foreign key loop detected.",534:"Foreign key {0} refers to source column of another foreign key.",535:"Schema is already finalized.",536:"Foreign key {0} refers to invalid table.",537:"Foreign key {0} refers to invalid column.",538:"Foreign key {0} column type mismatch.",539:"Foreign key {0} refers to non-unique column.",540:"Foreign key {0} has invalid reference syntax.",541:"Outer join accepts only join predicate.",542:"from() has to be called before innerJoin() or leftOuterJoin().",543:"Foreign key {0}. A primary key column can\'t also be a foreign key child column",544:"Duplicate primary key index found at {0}",545:"Primary key column {0} can\'t be marked as nullable",546:"Indices/constraints/columns can\'t re-use the table name {0}",547:"where() cannot be called before innerJoin() or leftOuterJoin().",548:"from() has to be called before where().",549:"from() has to be called before orderBy() or groupBy().",550:"where() clause includes an invalid predicate",900:"Test error",999:"Simulated error"};function initFirebase(e,t,o,a,n,r){importScripts("https://cdn.jsdelivr.net/npm/firebase@7.14.6/dist/index.cjs.min.js"),app=firebase.initializeApp({apiKey:e,authDomain:t,databaseURL:o,projectId:a,storageBucket:n,messagingSenderId:r})}function initIndexedDB(){importScripts("https://cdn.jsdelivr.net/npm/lovefield@2.1.12/dist/lovefield.min.js");var e=lf.schema.create("notebook",1);e.createTable("Notebook").addColumn("nid",lf.Type.INTEGER).addColumn("title",lf.Type.STRING).addColumn("subtitle",lf.Type.STRING).addColumn("author",lf.Type.STRING).addColumn("date",lf.Type.DATE_TIME).addColumn("locked",lf.Type.BOOLEAN).addColumn("toc",lf.Type.BOOLEAN).addColumn("color",lf.Type.STRING).addPrimaryKey(["nid"],!1).addUnique("uq_title",["title"]),e.createTable("Cell").addColumn("nid",lf.Type.INTEGER).addColumn("cid",lf.Type.INTEGER).addColumn("editor",lf.Type.BOOLEAN).addColumn("type",lf.Type.STRING).addColumn("input",lf.Type.STRING).addColumn("output",lf.Type.STRING).addPrimaryKey(["nid","cid"],!1);var t={storeType:lf.schema.DataStoreType.INDEXED_DB};e.connect(t).then((function(e){notebookDb=e,notebookTbl=e.getSchema().table("Notebook"),cellTbl=e.getSchema().table("Cell");var t=(new Date).valueOf(),o=notebookTbl.createRow({nid:t,title:"Untitled",subtitle:"quantitative finance in javascript",author:"anonymous",date:new Date,locked:!1,toc:!1,color:"dark"}),a=cellTbl.createRow({nid:t,cid:0,editor:!0,type:"javascript",input:"version",output:"0.3.6"});notebookDb.insertOrReplace().into(notebookTbl).values([o]).exec().then(()=>{notebookDb.insertOrReplace().into(cellTbl).values([a]).exec().catch(e=>{print("<br>"+e.code+":"+error_code[e.code])})}).catch(e=>{print("<br>"+e.code+":"+error_code[e.code])}),postMessage({id:void 0,result:"ready",fn:"oneTimeLoad"})}))}function sql(e=""){var t,o=_x_id_x_;try{t=sqlParser.parse(e)}catch(e){print(e.message)}var a={},n=[];t.value.from.value.forEach(e=>{var t=self[e.value.value.value+"Tbl"];t?(n.push(t),e.value.alias&&(a[e.value.alias.value]=e.value.value.value)):print("table "+e.value.value.value+" doesn\'t exit")});var r=[];t.value.selectItems.value.forEach(e=>{if("FunctionCall"==e.type){var t=lf.fn[e.name.toLowerCase()],o=[];e.params.forEach(e=>{var t=e.value;if(-1!==t.indexOf(".")){var r=t.split("."),l=self[a[r[0]]+"Tbl"];o.push(l[r[1]])}else o.push(n[0][e])}),r.push(t.call(self,...o))}else{var l,i=e.value;if(-1!==i.indexOf(".")){var s=i.split("."),d=self[a[s[0]]+"Tbl"];if(l=s[1],e.alias){var u=e.alias.replace(/`/g,"");r.push(d[l].as(u))}else r.push(d[l])}else if(l=i,e.alias){u=e.alias.replace(/`/g,"");r.push(n[0][l].as(u))}else r.push(n[0][l])}});var l,i=notebookDb.select(...r).from(...n);t.value.where&&(l=where(t.value.where,a,n)),l&&(i=i.where(l));var s=[];t.value.groupBy&&t.value.groupBy.value.forEach(e=>{var t=e.value.value;if(-1!==t.indexOf(".")){var o=t.split("."),r=self[a[o[0]]+"Tbl"];s.push(r[o[1]])}else s.push(n[0][t])}),s.length>0&&(i=i.groupBy(...s));var d=[];t.value.orderBy&&t.value.orderBy.value.forEach(e=>{var t=[],o=e.value.value;if(-1!==o.indexOf(".")){var r=o.split("."),l=self[a[r[0]]+"Tbl"];t.push(l[r[1]])}else t.push(n[0][o]);e.sortOpt&&t.push(lf.Order[e.sortOpt.toUpperCase()]),d.push(t)});for(var u=0;u<d.length;u++)i=i.orderBy(...d[u]);return i.exec().then((function(e){postMessage({id:o,result:e,fn:"sql"})})),{type:"sql"}}function where(e,t,o){var a,n=e.operator,r=e.left,l=e.right;switch(e.type){case"AndExpression":a=lf.op.and(where(r,t,o),where(l,t,o));break;case"OrExpression":a=lf.op.or(where(r,t,o),where(l,t,o));break;case"NotExpression":a=lf.op.not;break;case"ComparisonBooleanPrimary":var i,s;switch(r.type){case"Identifier":if(-1!=r.value.indexOf(".")){var d=r.value.split(".");i=self[t[d[0]]+"Tbl"][d[1]]}else i=o[0][r.value];break;case"Number":i=r.value;break;case"String":var u=r.value.length;i=r.value.substr(1,u-2);break;default:throw new Error("invalid type")}switch(l.type){case"Identifier":if(-1!=l.value.indexOf(".")){d=l.value.split(".");s=self[t[d[0]]+"Tbl"][d[1]]}else s=o[0][l.value];break;case"Number":s=l.value;break;case"String":u=l.value.length;s=l.value.substr(1,u-2);break;default:throw new Error("invalid type")}if("Identifier"==r.type&&"Identifier"==l.type)switch(n){case"=":a=i.eq(s);break;case"<>":a=i.neq(s);break;case"<":a=i.lt(s);break;case"<=":a=i.lte(s);break;case">":a=i.gt(s);break;case">=":a=i.gte(s);break;default:throw new Error("unkonwn operator")}else if("Identifier"==r.type&&"Identifier"!=l.type)switch(n){case"=":a=i.eq(s);break;case"<>":a=i.neq(s);break;case"<":a=i.lt(s);break;case"<=":a=i.lte(s);break;case">":a=i.gt(s);break;case">=":a=i.gte(s);break;default:throw new Error("unkonwn operator")}else{if("Identifier"==r.type||"Identifier"!=l.type)throw new Error("not supported");switch(n){case"=":a=s.eq(i);break;case"<>":a=s.neq(i);break;case"<":a=s.gte(i);break;case"<=":a=s.gt(i);break;case">":a=s.lte(i);break;case">=":a=s.lt(i);break;default:throw new Error("unkonwn operator")}}break;default:throw new Error("unkonwn type")}return a}function getNotebooks(){notebookDb.select(notebookTbl.title.as("Title"),notebookTbl.subtitle.as("Subtitle"),notebookTbl.author.as("Author"),notebookTbl.date.as("Date")).from(notebookTbl).orderBy(notebookTbl.date,lf.Order.DESC).exec().then((function(e){postMessage({id:-1,result:e,fn:"sql"})}))}function getNotebook(e){notebookDb.select(notebookTbl.title,notebookTbl.subtitle,notebookTbl.author,notebookTbl.locked,notebookTbl.color,notebookTbl.toc,cellTbl.cid,cellTbl.editor,cellTbl.type,cellTbl.input,cellTbl.output).from(notebookTbl,cellTbl).where(lf.op.and(notebookTbl.nid.eq(cellTbl.nid),notebookTbl.title.eq(e))).exec().then((function(e){for(var t={title:e[0].Notebook.title,subtitle:e[0].Notebook.subtitle,author:e[0].Notebook.author},o={locked:e[0].Notebook.locked,toc:e[0].Notebook.toc,color:e[0].Notebook.color},a={},n=0;n<e.length;n++){var r={input:{type:e[n].Cell.type,source:e[n].Cell.input},editor:e[n].Cell.editor,output:{type:"html",content:e[n].Cell.output}};a["cell"+e[n].Cell.cid]=r}postMessage({result:{meta:t,setting:o,notebook:a},fn:"open"})}))}function saveNotebook(e){var t=e.meta.title;notebookDb.select().from(notebookTbl).where(notebookTbl.title.eq(t)).exec().then(o=>{if(o.length>0){var a=o[0].nid;notebookDb.update(notebookTbl).set(notebookTbl.subtitle,e.meta.subtitle).set(notebookTbl.author,e.meta.author).set(notebookTbl.toc,e.setting.toc).set(notebookTbl.color,e.setting.color).set(notebookTbl.locked,e.setting.locked).set(notebookTbl.date,new Date).where(notebookTbl.nid.eq(a)).exec(),notebookDb.delete().from(cellTbl).where(cellTbl.nid.eq(a)).exec().then(()=>{var o=[];for(cell in e.notebook){var n=cellTbl.createRow({nid:a,cid:parseInt(cell.substr(4),10),editor:e.notebook[cell].editor,type:e.notebook[cell].input.type,input:e.notebook[cell].input.source,output:e.notebook[cell].output.content});o.push(n)}notebookDb.insertOrReplace().into(cellTbl).values(o).exec(),postMessage({result:\'Notebook "\'+t+\'" saved\',fn:"toast"})})}else{a=(new Date).valueOf();var n=notebookTbl.createRow({nid:a,title:t,subtitle:e.meta.subtitle,author:e.meta.author,date:new Date,locked:e.setting.locked,toc:e.setting.toc,color:e.setting.color});notebookDb.insertOrReplace().into(notebookTbl).values([n]).exec().then(()=>{var o=[];for(cell in e.notebook){var n=cellTbl.createRow({nid:a,cid:parseInt(cell.substr(4),10),editor:e.notebook[cell].editor,type:e.notebook[cell].input.type,input:e.notebook[cell].input.source,output:e.notebook[cell].output.content});o.push(n)}notebookDb.insertOrReplace().into(cellTbl).values(o).exec(),postMessage({result:\'Notebook "\'+t+\'" saved\',fn:"toast"})})}})}function deleteNotebook(e){notebookDb.select(notebookTbl.nid).from(notebookTbl).where(notebookTbl.title.eq(e)).exec().then((function(t){var o=t[0].nid;notebookDb.delete().from(notebookTbl).where(notebookTbl.nid.eq(o)).exec(),notebookDb.delete().from(cellTbl).where(cellTbl.nid.eq(o)).exec(),postMessage({result:\'Notebook "\'+e+\'" deleted\',fn:"toast"})}))}function metal(){}function wood(){}function water(){}function fire(){}function earth(){}function main(){initIndexedDB()}main();']),t=window.URL.createObjectURL(e);(worker=new Worker(t)).onmessage=function(e){var t=e.data.id,o=e.data.result;switch(e.data.fn){case"output":output(o,t);break;case"print":print(o,t);break;case"plot":break;case"table":table(o,t);break;case"oneTimeLoad":oneTimeLoad();break;case"help":help(o.html,o.link,o.section,o.what,t);break;case"sql":sql(o,t);break;case"open":fromJSON(o);break;case"toast":showToast(o);break;default:throw clearSpinner(t),new Error("invalid action")}}}function stopWorker(){worker.terminate(),worker=void 0}function toggleWorker(){worker?stopWorker():startWorker()}function clearSpinner(e){$(`#cell${e} .running`).remove(),$(`#cell${e} button`).prop("disabled",!1)}function updateTitle(){var e=$("#title").val();""==e&&(e="Welcome");var t=$("#subtitle").val();""==t&&(t='New to quantlib.js notebook? checkout: <br>\n<a target="_blank" href="/notebook/#tutorial.json">Tutorial <i class="fa fa-external-link"></i></a> <br>\n<a target="_blank" href="/docs/">API Docs <i class="fa fa-external-link"></i></a> <br>\n<a target="_blank" href="/test-suite/"> Test Suite <i class="fa fa-external-link"></i></a> <br>\n<a target="_blank" href="/funding/"> Fund quantlib.js to make it better <i class="fa fa-external-link"></i></a>');var o=`<div class="row">\n<div class="col-xl-1 hidden-lg-down px-0"></div>\n<div class="col-lg-12 col-xl-10 px-0">\n<div>\n<h1 class="text-center">${e}</h1>\n<p class="text-center">${t}</p>\n</div>\n</div>\n<div class="col-xl-1 hidden-lg-down px-0"></div>\n</div>`;$("#meta").empty(),$("#meta").append(o)}function color(){"dark"===theme?(theme="light",$(".cell.row").css("border-color",light_leave),resetChartTheme()):(theme="dark",$(".cell.row").css("border-color",dark_leave),resetChartTheme(),Highcharts.setOptions(dart_chart)),$("body").removeClass();var e="dark"===theme?"bootstrap-dark":"bootstrap";for(id in $("body").addClass(e),cells)cells[id].setOption("theme",`base16-${theme}`);"xl"==appSize&&$(`#cell${selected}`).find(".cell.btn-group").show(),$(`#cell${selected}`).css({"border-color":color_enter})}function getEditor(e,t,o=!1){var a=document.getElementById(e);return CodeMirror.fromTextArea(a,{theme:`base16-${theme}`,lineWrapping:!0,mode:t,readOnly:o})}function toggle(e){var t;locked?showToast("notebook is locked..."):isNaN(e)||("javascript"===cells[e].options.mode?(cells[e].setOption("mode","markdown"),t="markdown"):"markdown"===cells[e].options.mode?(cells[e].setOption("mode","sql"),t="sql"):(cells[e].setOption("mode","javascript"),t="javascript"),$(`#celltype${e}`).removeClass(),$(`#celltype${e}`).addClass(getCellTypeIcon(t)))}function eye(e){locked?showToast("notebook is locked..."):$(`#in${e}`).is(":visible")?$(`#in${e}`).hide():($(`#in${e}`).show(),setTimeout((function(){cells[e].refresh()}),10))}function hideEditor(e){$(`#in${e}`).is(":visible")&&$(`#in${e}`).hide()}function getCellTypeIcon(e){switch(e){case"javascript":return"fa fa-code";case"markdown":return"fa fa-sticky-note";case"sql":return"fa fa-cube";default:throw new Error("invalid mode")}}function add(e,t=NaN){if(locked)showToast("notebook is locked...");else{var o=counter++,a=getCellTypeIcon(e),n=`<div id="cell${o}" class="cell row no-gutters" ${touch?'ontouchstart="select2(':'onclick="select('}${o});" ${touch?"":'ondblclick="eye('+o+');"'}>\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="cell btn-group pull-right" role="group">\n  <button type="button" class="btn btn-sm" onclick="toggle(${o})"><i id="celltype${o}" class="${a}"></i></button>\n  <button type="button" class="btn btn-sm" onclick="add('javascript', ${o});"><i class="fa fa-plus"></i></button>\n  <button type="button" class="btn btn-sm" onclick="run(${o});"><i class="fa fa-play"></i></button>\n</div>\n</div>\n<div class="col-lg-12 col-xl-10 px-0">\n<div id="in${o}" class="input"><textarea id="edit${o}"></textarea></div>\n<div id="out${o}" class="output"></div>\n</div>\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="cell btn-group" role="group">\n  <button type="button" class="btn btn-sm" onclick="moveUp(${o});"><i class="fa fa-angle-up"></i></button>\n  <button type="button" class="btn btn-sm" onclick="del(${o});"><i class="fa fa-trash"></i></button>\n  <button type="button" class="btn btn-sm" onclick="moveDown(${o});"><i class="fa fa-angle-down"></i></button>\n</div>\n</div>\n</div>`;isNaN(t)?$("#notebook").append(n):$(n).insertAfter(`#cell${t}`);var l=getEditor(`edit${o}`,e);cells[o]=l,$(`#cell${o} .cell.btn-group`).hide(),$(`#cell${o}`).css({"border-color":"dark"===theme?dark_leave:light_leave})}}function del(e){locked?showToast("notebook is locked..."):isNaN(e)||confirm("Delete this cell?")&&(event.stopPropagation(),$(`#cell${e}`).remove(),delete cells[e],e==selected&&(selected=NaN))}function moveUp(e){locked?showToast("notebook is locked..."):$(`#cell${e}`).insertBefore($(`#cell${e}`).prev(".cell.row"))}function moveDown(e){locked?showToast("notebook is locked..."):$(`#cell${e}`).insertAfter($(`#cell${e}`).next(".cell.row"))}function toJSON(){var e={};e.meta={title:$("#title").val(),subtitle:$("#subtitle").val(),author:$("#author").val()},e.setting={locked:locked,toc:show_toc,color:theme},e.notebook={};for(var t=$(".cell.row"),o=0;o<t.length;o++){var a=t[o].id.substr(4),n={};n.input={type:cells[a].options.mode,source:cells[a].getValue()},n.editor=$(`#in${a}`).is(":visible"),n.output={type:"html",content:$(`#out${a}`).html()},e.notebook[`${t[o].id}`]=n}return JSON.stringify(e,null,"\t")}function fromJSON(e){for(cell in cells={},counter=0,selected=NaN,$("#title").val(e.meta.title),$("#subtitle").val(e.meta.subtitle),$("#author").val(e.meta.author),locked!=e.setting.locked&&($("#lock").toggleClass("fa-lock"),$("#lock").toggleClass("fa-unlock")),locked=e.setting.locked,show_toc!=e.setting.toc&&toggleToc(),show_toc=e.setting.toc,theme!=e.setting.color&&color(),theme=e.setting.color,$("#notebook").empty(),e.notebook){var t=parseInt(cell.substr(4),10);counter<t&&(counter=t);var o=e.notebook[cell].input.type,a=getCellTypeIcon(o);$("#notebook").append(`<div id="cell${t}" class="cell row no-gutters" ${touch?'ontouchstart="select2(':'onclick="select('}${t});" ${touch?"":'ondblclick="eye('+t+');"'}>\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="cell btn-group pull-right" role="group">\n  <button type="button" class="btn btn-sm" onclick="toggle(${t})"><i id="celltype${t}" class="${a}"></i></button>\n  <button type="button" class="btn btn-sm" onclick="add('javascript', ${t});"><i class="fa fa-plus"></i></button>\n  <button type="button" class="btn btn-sm" onclick="run(${t});"><i class="fa fa-play"></i></button>\n</div>\n</div>\n<div class="col-lg-12 col-xl-10 px-0">\n<div id="in${t}" class="input"><textarea id="edit${t}"></textarea></div>\n<div id="out${t}" class="output">${e.notebook[cell].output.content}</div>\n</div>\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="cell btn-group" role="group">\n  <button type="button" class="btn btn-sm" onclick="moveUp(${t});"><i class="fa fa-angle-up"></i></button>\n  <button type="button" class="btn btn-sm" onclick="del(${t});"><i class="fa fa-trash"></i></button>\n  <button type="button" class="btn btn-sm" onclick="moveDown(${t});"><i class="fa fa-angle-down"></i></button>\n</div>\n</div>\n</div>`);var n=getEditor(`edit${t}`,o,locked);n.setValue(e.notebook[cell].input.source),setTimeout((function(){n.refresh()}),10),cells[t]=n,e.notebook[cell].editor||eye(t)}$(".cell.btn-group").hide(),$(".cell.row").css({"border-color":"dark"===theme?dark_leave:light_leave}),hover(),counter++,updateToc(),updateInternalLink(),updateTitle(),$(".collapse").collapse("hide")}function select(e){if(selected!=e&&($(`#cell${selected}`).find(".cell.btn-group").hide(),$(`#cell${selected}`).css({"border-color":"dark"===theme?dark_leave:light_leave}),$(`#cell${selected}`).css({"border-left-width":"0.5px"}),$(`#cell${selected}`).css({"margin-left":"2px"}),selected=e,"xl"==appSize&&$(`#cell${e}`).find(".cell.btn-group").show(),$(`#cell${e}`).css({"border-color":color_enter}),$(`#cell${e}`).css({"border-left-width":"6px"}),$(`#cell${e}`).css({"margin-left":"-3.5px"})),!isNaN(e)){var t=getCellTypeIcon(cells[e].options.mode);$("#celltype").removeClass(),$("#celltype").addClass(t),$("#runsel").prop("disabled",$(`#cell${e} button`).prop("disabled")),$("#delsel").prop("disabled",$(`#cell${e} button`).prop("disabled"))}}function select2(e){select(e),tapped?(clearTimeout(tapped),tapped=null,eye(e)):tapped=setTimeout((function(){tapped=null}),300)}function hover(){$(document).on({mouseenter:function(){"xl"==appSize&&$(this).find(".cell.btn-group").show(),$(this).css({"border-color":color_enter})},mouseleave:function(){$(this).attr("id").substr(4)!=selected&&("xl"==appSize&&$(this).find(".cell.btn-group").hide(),$(this).css({"border-color":"dark"===theme?dark_leave:light_leave}))}},".cell.row")}function load(e){try{fetch(e).then(e=>e.json()).then(e=>{fromJSON(e)})}catch(e){console.log(e)}}function output(e,t){if(void 0!==e)switch(e.type){case"plot":switch(e.data.hcProduct){case"chart":Highcharts.chart(`ot${t}`,e.data);break;case"stock":Highcharts.stockChart(`ot${t}`,e.data);break;case"map":Highcharts.mapChart(`ot${t}`,e.data);break;case"gantt":Highcharts.ganttChart(`ot${t}`,e.data);break;default:throw new Error("empty or invalid chart type")}hideEditor(t),clearSpinner(t);break;case"table":var o=`${e.data}`;$(`#ot${t}`).append(o),clearSpinner(t);break;case"text":o=`<code>${e.data}</code>`;$(`#ot${t}`).append(o),clearSpinner(t);break;case"help":case"sql":case"promise":break;default:smart(e,t),clearSpinner(t)}else{if($(`#ot${t}`).is(":empty")){o=`<code>${e}</code>`;$(`#ot${t}`).append(o)}clearSpinner(t)}}function columnFormatter(e,t){return e instanceof Date?e.toISOString():e}function sql(e,t){var o=`<table id="tbl${t}"\ndata-classes="table table-hover table-sm"\ndata-show-columns="true"\ndata-show-columns-toggle-all="true"\ndata-search="true"\ndata-sort-class="table-active"\ndata-sortable="true"\ndata-pagination="true"\ndata-show-extended-pagination="true"\ndata-page-list="[10, 25, 50, 100, 200, All]"\ndata-click-to-select="true"\ndata-single-select="true"\ndata-checkbox-header="false"\ndata-maintain-meta-data="true"\n></table>`;$(`#ot${t}`).append(o);var a=[{field:"state",checkbox:!0}],n=[],l=e[0];for(td in l)if("object"!=typeof l[td]||l[td]instanceof Date)a.push({field:td,title:td,sortable:!0,formatter:"columnFormatter"});else for(c in l[td])a.push({field:td+"."+c,title:c,sortable:!0,formatter:"columnFormatter"});for(var r=0;r<e.length;r++){var i={};for(td in e[r])if("object"!=typeof e[r][td]||e[r][td]instanceof Date)i[td]=e[r][td];else for(c in e[r][td])i[td+"."+c]=e[r][td][c];n.push(i)}$(`#tbl${t}`).bootstrapTable({data:n,columns:a}),clearSpinner(t)}function help(e,t,o,a,n){var l="";null==o?l+=t+$(e).find("section.tsd-comment").html():(l+=t,null==a?$(e).find("section.tsd-kind-"+o).each((function(){l+=this.innerHTML})):$(e).find("section.tsd-kind-"+o).each((function(){var e=this.innerHTML;-1!=e.indexOf(`name="${a.toLowerCase()}`)&&(l+=e)}))),l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=l.replace(/<a href="../g,'<a target="_blank" href="https://quantlib.js.org/docs')).replace(/href="#"/g,"")).replace(/\<h1/g,"<section")).replace(/\/h1\>/g,"/section>")).replace(/\<h2/g,"<section")).replace(/\/h2\>/g,"/section>")).replace(/\<h3/g,"<section")).replace(/\/h3\>/g,"/section>")).replace(/\<h4/g,"<section")).replace(/\/h4\>/g,"/section>")).replace(/\<h5/g,"<section")).replace(/\/h5\>/g,"/section>")).replace(/\<h6/g,"<section")).replace(/\/h6\>/g,"/section>"),$(`#ot${n}`).append(l),latex(n),clearSpinner(n)}function smart(e,t){switch(typeof e){case"object":if(e instanceof Date)o=`<code>${e.toLocaleDateString()}</code>`;else if(e instanceof Array)if(e.every(e=>"string"==typeof e))o=`${JSON.stringify(e,null,2)}`;else{if(e.every(e=>"number"==typeof e)){renderVector(e,t);break}if(e.every(e=>e instanceof Array)){renderMatrix(e,t);break}if(e.every(e=>"object"==typeof e)){table(e);break}o=`${JSON.stringify(e,null,2)}`}else null!=e.LaTexString?o="$ "+e.LaTexString+" $":$(`#ot${t}`).jsonViewer(e,{collapsed:!0});$(`#ot${t}`).append(o),null!=e.LaTexString&&latex(t);break;case"function":var o="<code>[Function]</code>";$(`#ot${t}`).append(o);break;default:o=`<code>${e}</code>`;$(`#ot${t}`).append(o)}}function renderVector(e,t){var o="$";o+="\\begin{bmatrix}";for(var a=0;a<e.length;a++)o+=e[a],a!=e.length-1&&(o+="&");o+="\\end{bmatrix}",o+="$",$(`#ot${t}`).append(o),latex(t)}function renderMatrix(e,t){var o="$";o+="\\begin{bmatrix}";for(var a=0;a<e.length;a++){for(var n=0;n<e[0].length;n++)o+=e[a][n],n!=e[a].length-1&&(o+="&");o+="\\\\"}o+="\\end{bmatrix}",o+="$",$(`#ot${t}`).append(o),latex(t)}function print(e,t){var o=`<code>${e}<br></code>`;$(`#ot${t}`).append(o)}function table(e,t){if(!Array.isArray(e))return print(e);var o='<table class="table table-striped">',a=e[0];for(td in o+="<thead><tr>",a)o+=`<th>${td}</th>`;o+="</tr></thead><tbody>";for(var n=0;n<e.length;n++){for(td in o+="<tr>",e[n])o+=`<td>${e[n][td]}</td>`;o+="</tr>"}var l=`${o+="</tbody></table>"}`;$(`#ot${t}`).append(l)}function latex(e){var t=document.getElementById(`ot${e}`);renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})}function run(e){if(locked)showToast("notebook is locked...");else if(!isNaN(e)){$(`#out${e}`).empty(),$(`#out${e}`).append(`<div id=ot${e}></div>`);var t=cells[e].getValue();if("javascript"===cells[e].options.mode)$(`#cell${e} button`).prop("disabled",!0),$(`#out${e}`).prepend(indicator),worker.postMessage({id:e,source:t,fn:"code"});else if("sql"===cells[e].options.mode)$(`#cell${e} button`).prop("disabled",!0),$(`#out${e}`).prepend(indicator),worker.postMessage({id:e,source:t,fn:"sql"});else{hideEditor(e);try{var o=protectMath(t);$(`#ot${e}`).append(`${o}`),updateInternalLink(),latex(e)}catch(t){$(`#out${e}`).append(`<pre>${t.message}</pre>`)}}nextcell&&(event.stopPropagation(),next(e)),updateToc()}}function next(e){var t=$(".cell.row"),o=[];for(let e=0;e<t.length;e++){var a=parseInt(t[e].id.substr(4),10);o.push(a)}var n=o.indexOf(e);if(-1!=n&&n!=o.length-1){var l=o[n+1];select(l),scrollcell&&$("html, body").scrollTop($(`#cell${l}`).offset().top-offset)}}function runUp(){if(locked)showToast("notebook is locked...");else{var e=nextcell;nextcell=!1;for(var t=$(".cell.row"),o=0;o<t.length;o++){var a=parseInt(t[o].id.substr(4),10);if(a==selected)break;run(a)}nextcell=e}}function runDown(){if(locked)showToast("notebook is locked...");else{var e=nextcell;nextcell=!1;for(var t=$(".cell.row"),o=[],a=0;a<t.length;a++){var n=parseInt(t[a].id.substr(4),10);o.push(n)}var l=o.indexOf(selected);if(l>-1)for(a=l;a<o.length;a++)run(o[a]);nextcell=e}}function runAll(){if(locked)showToast("notebook is locked...");else{var e=nextcell;nextcell=!1;for(var t=$(".cell.row"),o=0;o<t.length;o++){run(t[o].id.substr(4))}nextcell=e}}function runMD(){for(var e=$(".cell.row"),t=0;t<e.length;t++){var o=e[t].id.substr(4);$(`#celltype${o}`).hasClass("fa-sticky-note")&&run(o)}}function updateToc(){if("xl"==appSize){$("#toc").empty();var e=createChildNavList($("#toc")),t=getTopLevel($("#notebook"));populateNav(e,t,getHeadings($("#notebook"),t)),$('[data-spy="scroll"]').each((function(){$(this).scrollspy("refresh")})),$("#toc a").on("click",linkOffset)}}function linkOffset(){event.preventDefault(),$("html, body").scrollTop($($(this).attr("href")).offset().top-offset)}function updateInternalLink(){$("#notebook .internal-link").on("click",linkOffset)}function toggleToc(){$("#tocroot").toggle(),$("#nbroot").toggleClass("col-xl-10"),$("#nbroot").toggleClass("col-xl-12")}function clearAll(){if(locked)showToast("notebook is locked...");else{for(var e=$(".cell.row"),t=0;t<e.length;t++){var o=e[t].id.substr(4);$(`#out${o}`).empty(),$(`#in${o}`).is(":visible")||($(`#in${o}`).show(),setTimeout((function(){cells[o].refresh()}),10))}$("#toc").empty()}}function clearCell(e){locked?showToast("notebook is locked..."):($(`#out${e}`).empty(),$(`#in${e}`).is(":visible")||$(`#in${e}`).show())}function compass(){isNaN(selected)||$("html, body").scrollTop($(`#cell${selected}`).offset().top-offset)}function findOrFilter(e,t){var o=e.find(t);return e.filter(t).add(o).filter(":not([data-toc-skip])")}function createChildNavList(e){var t=$('<ul class="nav navbar-nav"></ul>');return e.append(t),t}function generateNavEl(e,t){var o=$('<a class="nav-link"></a>');o.attr("href","#"+e),o.text(t);var a=$("<li></li>");return a.append(o),a}function generateNavItem(e){var t=e.id,o=$(e);return generateNavEl(t,o.data("toc-text")||o.text())}function getTopLevel(e){for(var t=1;t<=6;t++){if(findOrFilter(e,"h"+t).length>1)return t}return 1}function getHeadings(e,t){return findOrFilter(e,"h"+t+","+("h"+(t+1)))}function getNavLevel(e){return parseInt(e.tagName.charAt(1),10)}function populateNav(e,t,o){var a,n=e;o.each((function(o,l){var r=generateNavItem(l);getNavLevel(l)===t?n=e:a&&n===e&&(n=createChildNavList(a)),n.append(r),a=r}))}function getResponsiveBreakpoint(){var e={xs:"d-none",sm:"d-sm-none",md:"d-md-none",lg:"d-lg-none",xl:"d-xl-none"},t="",o=$("<div>");o.appendTo($("body"));for(var a=Object.keys(e).length-1;a>=0&&(t=Object.keys(e)[a],o.addClass(e[t]),!o.is(":hidden"));a--);return o.remove(),t}var tokenType={MARK:0,MASK:1},tokenLiteral={MASK:"::MASK::"};function tokenize(e){for(var t,o,a=["\\\\\\$","\\$\\$(?:[^\\\\]|\\\\.)*?\\$\\$","\\$(?:[^$\\\\]|\\\\.)+?\\$",tokenLiteral.MASK].join("|"),n=new RegExp(a,"g"),l=[],r=0;null!==(t=n.exec(e));)t.index>r&&(o=e.substring(r,t.index),l.push([tokenType.MARK,o])),l.push([tokenType.MASK,t[0]]),r=n.lastIndex;return o=e.substring(r),e.length>r&&l.push([tokenType.MARK,o]),l}function protectMath(e){for(var t=tokenize(e),o="",a=[],n=0;n<t.length;n++)t[n][0]==tokenType.MARK?o+=t[n][1]:(a.push(n),o+=tokenLiteral.MASK);o=marked(o);var l=new RegExp(tokenLiteral.MASK,"g"),r=0;return o=o.replace(l,(function(){return t[a[r++]][1]}))}function toggleLock(){if(locked)for(id in locked=!1,cells)cells[id].setOption("readOnly",!1);else for(id in locked=!0,cells)cells[id].setOption("readOnly",!0);$("#lock").toggleClass("fa-lock"),$("#lock").toggleClass("fa-unlock")}function resetChartTheme(){var e=Highcharts.getOptions();for(var t in e)"function"!=typeof e[t]&&delete e[t];Highcharts.setOptions(HCDefaults)}function handleResize(){"xl"==(appSize=getResponsiveBreakpoint())?(runMD(),$(`#cell${selected}`).find(".cell.btn-group").show()):($("#toc").empty(),$(`#cell${selected}`).find(".cell.btn-group").hide()),$(".collapse").collapse("hide"),setTimeout((function(){$("nav > .container-fluid > .btn").remove(),$("#navbarSupportedContent > .btn").remove();for(var e=toolbar.length,t=0;t<toolbar.length;t++)if($(toolbar[t]).insertBefore(".navbar-toggler"),$(".navbar").height()>40){e=t,$(".navbar-toggler").prev().remove();break}for(t=e;t<toolbar.length;t++)$("#navbarSupportedContent").append(toolbar[t])}),500)}function oneTimeLoad(){var e=window.location.hash;""!==e?load(e=e.substr(1)):updateTitle(),listNotebooks(),hover(),handleResize(),$(".taiji").remove()}function listNotebooks(e=!1){$("#ot-1").empty(),e?setTimeout(()=>{worker.postMessage({id:void 0,source:"getNotebooks();",fn:"code"})},1e3):worker.postMessage({id:void 0,source:"getNotebooks();",fn:"code"})}function openNotebook(){var e=$("#tbl-1").bootstrapTable("getSelections");if(e.length>0){var t=e[0].Title;if(!confirm(`Unsaved change in working notebook will be lost, proceed to open "${t}"?`))return;worker.postMessage({id:void 0,source:`getNotebook('${t}');`,fn:"code"}),$("#opendialog").modal("hide")}else showToast("no record selected")}function saveAs(){if(document.getElementById("saveform").checkValidity()){var e=$("#title").val().toLowerCase().replace(" ","_")+".json",t=toJSON();e=encodeURI(e);var o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else showToast('You must provide a "Title" to download the notebook')}function saveNotebook(){if(document.getElementById("saveform").checkValidity()){var e=toJSON();worker.postMessage({id:void 0,source:`saveNotebook(${e});`,fn:"code"}),$("#savedialog").modal("hide"),listNotebooks(!0)}else showToast('You must provide a "Title" to save the notebook')}function deleteNotebook(){var e=$("#tbl-1").bootstrapTable("getSelections");if(e.length>0){var t=e[0].Title;if(!confirm(`Delete notebook: "${t}"?`))return;worker.postMessage({id:void 0,source:`deleteNotebook('${t}');`,fn:"code"}),$("#opendialog").modal("hide"),listNotebooks(!0)}else showToast("no record selected")}function showToast(e,t="info",o=5e3){$.toast({title:"quantlib.js",subtitle:(new Date).toLocaleTimeString(),content:e,type:t,delay:o})}function main(){mobile?(scrollcell=!0,$(".navbar").addClass("fixed-bottom"),$("body").css({"margin-bottom":56}),offset=0):(scrollcell=!1,$(".navbar").addClass("sticky-top")),$(document).on("dragenter",(function(e){e.stopPropagation(),e.preventDefault()})),$(document).on("dragover",(function(e){e.stopPropagation(),e.preventDefault()})),$(document).on("drop",(function(e){e.preventDefault(),(file=e.originalEvent.dataTransfer.files[0])&&reader.readAsText(file)})),reader.onload=function(e){var t=e.target.result;try{fromJSON(JSON.parse(t))}catch(e){console.log(e)}finally{file=void 0,t=void 0}},window.addEventListener("resize",handleResize);var e=new marked.Renderer;e.link=function(e,t,o){var a=marked.Renderer.prototype.link.apply(this,arguments);return-1==e.indexOf("/")&&-1==e.indexOf(".json")?a.replace("<a","<a class='internal-link'"):a.replace("<a","<a target='_blank'")},marked.setOptions({renderer:e,gfm:!0}),$("#tocroot").hide(),Highcharts.setOptions(dart_chart),$(window).bind("keydown",(function(e){if(e.ctrlKey||e.metaKey)switch(String.fromCharCode(e.which).toLowerCase()){case"s":e.preventDefault(),saveNotebook()}})),$(document).keyup((function(e){"Escape"===e.key&&select(NaN)}))}function metal(){}function wood(){}function water(){}function fire(){}function earth(){}!function(e){function t(e){return e instanceof Object&&Object.keys(e).length>0}e.fn.jsonViewer=function(o,a){return a=Object.assign({},{collapsed:!1,rootCollapsable:!0,withQuotes:!1,withLinks:!0},a),this.each((function(){var n=function e(o,a){var n="";if("string"==typeof o)o=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"),a.withLinks&&/^(https?:\/\/|ftps?:\/\/)?([a-z0-9%-]+\.){1,}([a-z0-9-]+)?(:(\d{1,5}))?(\/([a-z0-9\-._~:/?#[\]@!$&'()*+,;=%]+)?)?$/i.test(o)?n+='<a href="'+o+'" class="json-string" target="_blank">'+o+"</a>":n+='<span class="json-string">"'+(o=o.replace(/&quot;/g,"\\&quot;"))+'"</span>';else if("number"==typeof o)n+='<span class="json-literal">'+o+"</span>";else if("boolean"==typeof o)n+='<span class="json-literal">'+o+"</span>";else if(null===o)n+='<span class="json-literal">null</span>';else if(o instanceof Array)if(o.length>0){n+='[<ol class="json-array">';for(var l=0;l<o.length;++l)n+="<li>",t(o[l])&&(n+='<a class="json-toggle"></a>'),n+=e(o[l],a),l<o.length-1&&(n+=","),n+="</li>";n+="</ol>]"}else n+="[]";else if("object"==typeof o){var r=Object.keys(o).length;if(r>0){for(var i in n+='{<ul class="json-dict">',o)if(Object.prototype.hasOwnProperty.call(o,i)){n+="<li>";var s=a.withQuotes?'<span class="json-string">"'+i+'"</span>':i;t(o[i])?n+='<a class="json-toggle">'+s+"</a>":n+=s,n+=": "+e(o[i],a),--r>0&&(n+=","),n+="</li>"}n+="</ul>}"}else n+="{}"}return n}(o,a);a.rootCollapsable&&t(o)&&(n='<a class="json-toggle"></a>'+n),e(this).html(n),e(this).addClass("json-document"),e(this).off("click"),e(this).on("click","a.json-toggle",(function(){var t=e(this).toggleClass("collapsed").siblings("ul.json-dict, ol.json-array");if(t.toggle(),t.is(":visible"))t.siblings(".json-placeholder").remove();else{t.children("li").length;t.after('<a class="json-placeholder">...</a>')}return!1})),e(this).on("click","a.json-placeholder",(function(){return e(this).siblings("a.json-toggle").click(),!1})),1==a.collapsed&&e(this).find("a.json-toggle").click()}))}}(jQuery),function(e){e.toast=function(t){var o=e("body");t.container&&1===t.container.length&&(o=t.container),o.children(".toast-container").length||(o.prepend('<div class="toast-container" aria-live="polite" aria-atomic="true"></div>'),o.children(".toast-container").append('<div class="toast-wrapper"></div>'),o.on("hidden.bs.toast",".toast",(function(){e(this).remove()})));var a=o.children(".toast-container").children(".toast-wrapper"),n="toast-"+(e(".toast").length+1),l="",r="",i="",s="text-muted",c="",d=t.title||"Notice!",u=t.subtitle||"",p=t.content||"",b=t.type||"info",f=t.delay||-1,h=t.img,v=t.pause_on_hover||!1,g=!1,k="";switch(b){case"info":r="bg-info",i="text-white",s="text-white",c="text-white";break;case"success":r="bg-success",i="text-white",s="text-white",c="text-white";break;case"warning":case"warn":r="bg-warning",i="text-white",s="text-white",c="text-white";break;case"error":case"danger":r="bg-danger",i="text-white",s="text-white",c="text-white"}!1!==v?(k='data-autohide="false"',v='data-hide-timestamp="'+(Math.floor(Date.now()/1e3)+f/1e3)+'"'):k=-1===f?'data-autohide="false"':'data-delay="'+f+'"';l='<div id="'+n+'" class="toast" role="alert" aria-live="assertive" aria-atomic="true" '+k+" "+v+">",l+='<div class="toast-header '+r+" "+i+'">',void 0!==h&&(l+='<img src="'+h.src+'" class="'+(h.class||"")+' mr-2" alt="'+(h.alt||"Image")+'" '+(void 0!==h.title?'data-toggle="tooltip" title="'+h.title+'"':"")+">"),l+='<strong class="mr-auto">'+d+"</strong>",l+='<small class="'+s+'">'+u+"</small>",l+='<button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">',l+='<span aria-hidden="true" class="'+c+'">&times;</span>',l+="</button>",l+="</div>",""!==p&&(l+='<div class="toast-body">',l+=p,l+="</div>"),l+="</div>",a.append(l),a.find(".toast:last").toast("show"),!1!==v&&(setTimeout((function(){g||e("#"+n).toast("hide")}),f),e(document).on("mouseover","#"+n,(function(){g=!0})),e(document).on("mouseleave","#"+n,(function(){var t=Math.floor(Date.now()/1e3),o=parseInt(e(this).data("hide-timestamp"));g=!1,t>=o&&e(this).toast("hide")})))}}(jQuery),$(document).ready((function(){main(),startWorker()}));</script>  
  </body>
</html>
